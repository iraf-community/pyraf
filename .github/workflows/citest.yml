
name: PyRAF CI test

on: [push, pull_request]

jobs:
  tests:
    name: ${{ matrix.name }}
    runs-on: ${{ matrix.os }}
    env:
      tmp: /tmp/
      iraf: /usr/lib/iraf/
      TERM: dumb

    strategy:
      matrix:
        include:
          - name: Ubuntu 20.04 (Focal) Python-3.8.2
            os: ubuntu-20.04

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Setup dependencies
        run: |
          sudo apt-get update
          sudo apt-get install --no-install-recommends iraf iraf-noao iraf-dev build-essential libx11-dev
          sudo apt-get install --no-install-recommends python3-all-dev python3-pip python3-astropy python3-numpy-dev python3-setuptools python3-setuptools-scm python3-tk python3-pytest python3-pytest-cov ipython3
          pip3 install "stsci.tools>=4.0.1"

      - name: Build Pyraf
        run: |
           python3 setup.py build_ext -i

      - name: Run tests
        run: |
          export PATH=$(pwd)/scripts:${PATH}
          python3 -m pytest --cov=pyraf
